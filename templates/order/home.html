{% extends "../base.html" %}

{% block title %}Listado de pedidos {% end %}
{% block caption %}se muestra una lista general de todos los pedidos{% end %}
{% block css %}
    <link href="/{{nocache_static}}/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="/{{nocache_static}}/css/dataTables.tableTools.min.css" rel="stylesheet">
{% end %}
{% block javascript %}
<script type="text/javascript" src="/{{nocache_static}}/js/lp.js" charset="utf-8"></script>
<script type="text/javascript" src="/{{nocache_static}}/js/jquery.dataTables.min.js" charset="utf-8"></script>
<script type="text/javascript" src="/{{nocache_static}}/js/dataTables.tableTools.min.js" charset="utf-8"></script>
<script type="text/javascript" src="/{{nocache_static}}/js/order_list.js" charset="utf-8"></script>
{% end %}
{% block body %}

{% if dn == "bpf" %}
<div class="alert alert-warning alert-success-nohidden">
    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
    <strong><i class="fa fa-check"></i> Problema al eliminar el pedido!</strong> aún quedan pedidos.
</div>
{% elif dn == "bpt" %}
<div class="alert alert-success alert-success-nohidden">
    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
    <strong><i class="fa fa-check"></i> Bien hecho!</strong> se ha eliminado el pedido.
</div>
{% end %}

<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">N&uacute;meros de seguimiento</h4>
      </div>
      <div class="modal-body">
        <form id="shipping-tracking" class="form-inline" action="/shipping/save_tracking" method="get"></form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary" onclick='return ValidateTracking()'>Guardar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div class="modal fade" id="iframe_detalle">
  <div class="modal-dialog">
    <div class="modal-content">
      <iframe src="" width="100%" height="100%" frameborder="0" allowtransparency="true"></iframe> 
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="col-md-12">
    <section class="widget">
        <div class="body">
            <table class="table table-striped table-images">
                <thead>
                    <tr>
                        <th class="action col-sm-5">
                            <select data-placeholder="Acciones"
                            data-minimum-results-for-search="10"
                            tabindex="-1"
                            class="chzn-select select-block-level" id="default-select">
                                <option value=""></option>
                                <!-- <option value="1">Eliminar</option> -->
                                <option value="2">Confirmado</option>
                                <option value="3">Listo para despacho</option>
                                <option value="4">Despachado</option>
                                <option value="5">Cancelado</option>
                            </select>
                        </th>
                        <th>
                            <button type="button" id="aplicar" class="btn btn-primary">Aplicar</button>
                        </th>
                        <th class="state-filter text-right">
                            <span class="label label-default state-filter">TODOS</span>
                            <span class="label label-warning state-filter">POR CONFIRMAR</span>
                            <span class="label label-success state-filter">CONFIRMADO</span>
                            <span class="label label-info state-filter">LISTO PARA DESPACHO</span>
                            <span class="label label-primary state-filter">DESPACHADO</span>
                            <span class="label label-danger state-filter">CANCELADO</span>
                        </th>
                    </tr>
                </thead>
            </table>
            <table id="pedidos" class="table table-striped table-images">
                <thead>
                    <tr>
                        <th class="no-sort"></th>
                        <th>ID</th>
                        <th>Fecha</th>
                        <th>Cliente</th>
                        <th>Tipo</th>
                        <th>Origen</th>
                        <!--<th>Direcci&oacute;n</th>
                         <th>Comuna</th>
                        <th>Ciudad</th> -->
                        <!-- <th>Pa&iacute;s</th> -->
                        <!-- <th>Cantidad</th> -->
                        <!-- <th>Cantidad Productos</th> -->
                        <th>Total</th>
                        <th>Status</th>
                        <th>Pago</th>
                        <th>C&oacute;digo Webpay</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in pedidos %}
                    <tr>
                        <td>
                            {% if int(p["state"]) != 3 %}
                                <input type="checkbox" name="pedidos" class="iCheck" value="{{p['order_id']}}" tracking-code="-">
                            {% else %}
                                <input type="checkbox" name="pedidos" class="iCheck" value="{{p['order_id']}}" tracking-code="{{p['tracking_code']}}">
                            {% end %}
                        </td>
                        <td>
                            {{p["order_id"]}}
                        </td>
                        <td>
                            {{p["date"]}}
                        </td>
                        <td>
                            {{p["customer"]}}
                        </td>
                        <td>
                            {{ p["tipo_cliente"] }}
                        </td>
                        <td>
                            {{p["source"]}}
                        </td>
                        <!-- <td>
                            {{p["items_quantity"]}}
                        </td> -->
                        <td>
                            {{money_format(p["total"])}}
                        </td>
                        <td>
                            {% if int(p["state"]) == 1 %}
                                {% if int(p["payment_type"]) == 1 %}
                                    <span class="label label-warning">POR CONFIRMAR</span>
                                {% elif int(p["payment_type"]) == 2 %}
                                    <span class="label label-warning">RECHAZADO</span>
                                {% end %}
                            {% elif int(p["state"]) == 2 %}
                                <span class="label label-important">CONFIRMADO</span>
                            {% elif int(p["state"]) == 3 %}
                                <span class="label label-info">LISTO PARA DESPACHO</span>
                            {% elif int(p["state"]) == 4 %}
                                <span class="label label-success">DESPACHADO</span>
                            {% else %}
                                <span class="label label-default">CANCELADO</span>
                            {% end %}
                        </td>
                        <td>
                            {% if int(p["payment_type"]) == 1 %}
                                TRANSFERENCIA
                            {% elif int(p["payment_type"]) == 2 %}
                                WEBPAY
                            {% end %}
                        </td>
                        <td></td>
                        <td>
                            <a class="btn btn-primary" href="/order-detail/list?order_id={{p['order_id']}}">Ver Detalle</a>
                        </td>
                    </tr>
                    {% end %}
                </tbody>
            </table>
            <footer></footer>
        </div>
    </section>
</div>

{% end %}